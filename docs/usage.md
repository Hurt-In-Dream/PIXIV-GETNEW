# 使用教程

部署完成后，你可以通过 Web 管理面板控制整个系统的运行。

## 1. 管理面板概览

访问你的部署域名，你将看到以下模块：

### 📊 统计数据
显示当前数据库中已存储的图片总数、今日新增数量以及 R2 存储状态。

### ⚙️ 设置面板
- **Cron 表达式**: 虽然在 `vercel.json` 中定义了触发频率，但你可以在这里记录或参考。
- **抓取标签**: 输入你感兴趣的 Pixiv 标签（如 `碧蓝航线`, `原神`），系统在自动抓取时会随机挑选一个标签进行搜索。
- **R-18 开关**: 开启后，自动抓取将包含 R-18 排行榜。

### 🚀 手动抓取
- **功能**: 立即从 Pixiv 排行榜抓取图片。
- **自定义**: 可以通过滑块选择抓取数量 (5-50张)。
- **智能筛选**: 系统会自动平衡横竖屏比例 (1:1)，并过滤掉无背景、漫画、AI 生成等不适合做背景图的作品。

### 🔍 PID 抓取
- **功能**: 输入特定的 Pixiv 作品 ID (PID) 进行抓取。
- **相关推荐**: 开启后，系统会同时抓取该作品下的相关推荐作品。
- **自定义数量**: 可调节相关推荐的抓取上限。

### 📋 活动日志
- **实时记录**: 显示当前页面的操作日志（如：开始抓取、抓取成功、跳过重复等）。
- **注意**: 此日志为前端内存存储，刷新页面后会清空。

### 🖼️ 图片库
- **浏览**: 查看所有已转存到 R2 的图片。
- **管理**: 
  - 点击图片可查看原图。
  - 点击 "复制链接" 获取 R2 公开访问地址。
  - 点击 "删除" 可从数据库和 R2 (如果配置了 API) 中移除记录。

## 2. 存储逻辑说明

系统会自动将图片分类存储在 R2 的不同文件夹中：

- `h/`: 横屏图片 (Landscape)
- `v/`: 竖屏图片 (Portrait)
- `R18/h/`: R18 横屏图片
- `R18/v/`: R18 竖屏图片

文件名格式为：`日期_PID.jpg` (例如 `20260101_11451419.jpg`)。

## 3. 常见问题 (FAQ)

### 为什么抓取失败并显示 401？
这通常意味着你的 `PIXIV_PHPSESSID` 过期了。Pixiv 的 Session ID 有效期不固定，失效后请按照 [环境变量指南](./env-vars.md) 重新获取并更新 Vercel 环境变量。

### 为什么有些图片被跳过了？
系统内置了智能过滤机制，会自动跳过：
1. 数据库中已存在的 PID（避免重复存储）。
2. 标签中包含“漫画”、“AI生成”、“透明背景”、“草稿”等关键词的作品。
3. 为了维持横竖屏 1:1 比例，如果某种方向的图片已达上限，会跳过后续同方向的图片。

### 如何作为 API 使用？
你可以直接通过 SQL 查询 Supabase 数据库获取图片链接，或者直接拼接你的 R2 域名和路径（如 `https://your-r2.com/v/20260101_12345.jpg`）来作为随机背景图源。
